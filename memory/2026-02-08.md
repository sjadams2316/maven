# 2026-02-08 Session Notes

## GitHub Setup
- Connected workspace to GitHub: https://github.com/sjadams2316/maven
- Created Personal Access Token with repo scope
- Cleaned up node_modules and API keys from git history
- Configured git identity as "Sam Adams"

## UI Polish
- **Glowing Oracle Ball**: Added breathing/pulsing animation to floating chat button
  - 3-second animation cycle
  - Purple glow radiates outward (box-shadow layers)
  - Subtle scale pulse (1.0 ‚Üí 1.05)
  - Changed icon to üîÆ crystal ball

- **Reorganized Dashboard Tools**:
  - **Primary Tools** (5 visible): Oracle, Portfolio Lab, Fragility Index, Tax-Loss Harvester, Financial Snapshot
  - **Additional Tools** (collapsible, 8 more): Social Security, Retirement Optimizer, What-If Scenarios, Roth Converter, Rebalancing, Risk Analysis, Link Accounts, Collaborative Planning
  - Market Fragility Index promoted to Primary per Sam's feedback

## Business Strategy: Maven Tiering
Created `maven/docs/TIERING.md` defining three tiers:

1. **Maven Basic** (Free)
   - Top of funnel, lead gen
   - Limited features, manual entry only
   
2. **Maven Pro** ($29-49/month)
   - DIY investors who want tools
   - Full features, Plaid linking
   - Conversion funnel to Partners
   
3. **Maven Partners** (Included in AUM)
   - **This is the business** ‚Äî RIA clients
   - Schwab direct link, advisor curation
   - White-glove onboarding with welcome card
   - "You see everything, they see what you want"

Key innovation: **Advisor-controlled UX** ‚Äî advisors can curate which insights clients see (show/hide/contextualize). Solves the "client sees scary risk" problem.

Morgan Stanley / E*Trade comp: Pro users are a prospecting funnel that converts to Partners when life events happen.

## Advisor Dashboard (MAJOR BUILD)
Built complete advisor control plane at `/advisor`:

### Pages Created:
1. **`/advisor`** - Advisor home
2. **`/advisor/clients`** - Client list
3. **`/advisor/clients/[id]`** - Client detail with 5 tabs
4. **`/advisor/clients/[id]/prep`** - Meeting prep
5. **`/advisor/insights`** - Global insights view
6. **`/advisor/settings`** - Firm settings
7. **`/advisor/analytics`** - Practice analytics
8. **`/advisor/clients/invite`** - Client invite flow

## Morning Build Session

**Client Flow:**
- `/join/[code]` - Partner onboarding

**User Features:**
- `/goals` ‚Äî Financial goals tracker
- `/family` ‚Äî Multi-generational dashboard
- `/crypto` ‚Äî Crypto holdings with live data
- `/documents` ‚Äî Document vault
- `/accounts/link` ‚Äî Plaid-style account linking
- `/home` ‚Äî Marketing landing page
- `/onboarding` ‚Äî 5-step new user flow
- `/settings`, `/notifications`, `/activity`, `/billing`, `/refer`, `/changelog`
- Tax planning, income tracker, spending tracker, estate planning, insurance
- Mobile nav, quick actions

---

## Afternoon Build Session (12:00+ EST)

Built 12 more pages:

### Compliance & Regulatory:
- `/compliance` ‚Äî Compliance task tracker (agreements, questionnaires, reviews, disclosures, audit log)
- `/compliance/questionnaire` ‚Äî Interactive risk tolerance questionnaire with scoring and suggested allocation

### Portfolio Management:
- `/performance` ‚Äî Performance attribution (returns by holding, factor attribution, alpha analysis, risk metrics)
- `/rebalance` ‚Äî Full rebalancing tool (drift detection, tax-aware mode, trade preview, model portfolios)
- `/benchmarks` ‚Äî Compare portfolio vs SPY, VTI, QQQ, bonds, Bitcoin with alpha calculations
- `/trade` ‚Äî Trade center (order ticket, positions, open orders, recent fills)

### Tax & Planning:
- `/asset-location` ‚Äî Asset location optimizer (tax drag analysis, optimal placement recommendations)
- `/monte-carlo` ‚Äî Monte Carlo retirement simulator (1,000+ scenarios, success rate, fan chart)
- `/income` ‚Äî Income planner (dividend/interest/SS/pension tracking, retirement income projections)

### Alerts & Reports:
- `/alerts` ‚Äî Alert center (fragility, drift, tax, earnings, dividends, compliance alerts)
- `/alerts/settings` ‚Äî Configure alert thresholds, channels (email/push/SMS), quiet hours, price alerts
- `/reports` ‚Äî Report generator (performance, holdings, tax, client review, risk, ESG templates)

**Total new code:** ~150KB across 12 pages

---

## Evening Build Session - Monte Carlo Deep Upgrade

Sam asked me to make the Monte Carlo "the most accurate tool out there" with continuous upgrades. Built a production-grade system:

### Historical Data Layer (`/lib/historical-returns.ts`)
- 97 years of S&P 500 annual returns (1928-2024)
- 10-Year Treasury Bond returns (1928-2024)
- International (EAFE) returns (1970-2024)
- Gold returns (1972-2024)
- REIT returns (1972-2024)
- Bitcoin returns (2011-2024)
- CPI inflation rates (1928-2024)
- **Correlation matrix** between all asset classes
- Historical drawdown periods

### Monte Carlo Engine (`/lib/monte-carlo-engine.ts`)
- **Bootstrap sampling** from actual historical returns (not random normal)
- **Fat-tailed distributions** using Student's t-distribution for crash scenarios
- **Correlation-aware** multi-asset simulation
- Multiple withdrawal strategies (fixed, flexible, guardrails)
- Glide path allocation adjustment over time
- Social Security integration
- Basic tax modeling (RMD, qualified vs non-qualified)
- 1,000+ simulation runs per analysis

### Stress Test System (`/lib/stress-test-scenarios.ts`)
Historical crisis scenarios with actual asset class returns:
- Global Financial Crisis (2007-2009)
- COVID-19 Crash (2020)
- Dot-Com Crash (2000-2002)
- 2022 Bear Market
- Black Monday 1987
- 1973-74 Oil Crisis
- Euro Debt Crisis (2011)
- 1994 Rising Rates

### Safe Withdrawal Rate Calculator (`/lib/safe-withdrawal.ts`)
- Historical SWR analysis across all 97 years
- Multiple withdrawal strategies (Fixed, Guardrails, RMD-style, Floor/Ceiling)
- **Sequence of returns risk** visualization
- Worst/best case historical periods identification

### Valuation Indicators (`/lib/valuation-indicators.ts`)
- CAPE ratio historical data and projections
- Buffett Indicator (Market Cap to GDP)
- Fed Model (earnings yield vs treasury)
- Expected return estimation from valuations
- Market outlook generator

### New Pages:
- `/stress-test` ‚Äî Historical crisis impact analysis
- `/safe-withdrawal` ‚Äî SWR calculator with sequence risk
- `/monte-carlo` ‚Äî Upgraded with real historical data

### API Endpoints:
- `/api/historical-returns` ‚Äî Fetches live data from FRED
- `/api/monte-carlo` ‚Äî Runs simulations server-side
- `/api/valuations` ‚Äî Current market valuation indicators

### Commits:
- `1b17978` - Major Monte Carlo upgrade (historical bootstrap, fat tails, correlation, stress testing)
- `35e8b36` - Safe Withdrawal Rate calculator with sequence risk

### Still TODO:
- Integrate valuation data into Monte Carlo expected returns
- Market Outlook page using valuation indicators
- Real-time data refresh for historical returns
- Sensitivity analysis visualization

## Bug Fixes

### Oracle Claude Integration
- **Issue:** Oracle sometimes falls back to generic responses
- **Root cause:** Missing `ANTHROPIC_API_KEY` in `.env.local`
- **Fix:** Added placeholder in .env.local, updated fallback to clearly indicate when in fallback mode, updated UI to say "Powered by Claude"
- **Action needed:** Sam needs to add his Anthropic API key to `maven/apps/dashboard/.env.local`

### Bitcoin Price
- **Issue:** Sam thought BTC price was incorrect/hardcoded
- **Reality:** BTC price IS live from Polygon API ‚Äî $69,289 is the actual current price
- Data sources confirmed working: Yahoo (indices), Polygon/CoinGecko (crypto)

---

## Git Commits Today
- Initial morning commits (from previous session)
- "Add 12 new pages: compliance, risk questionnaire, performance attribution, rebalance, benchmarks, trade center, asset location, monte carlo, income planner, alerts + settings, reports"

## Total Pages Built: 36+ pages
## Total Lines of Code: ~15,000+

üöÄüöÄüöÄ Massive build weekend

---

## Afternoon Session (2:00 PM - 2:40 PM)

### Landing Page Fix
- Removed auto-redirect for signed-in users
- Users now always see landing page first, can choose to go to dashboard

### Dashboard Reorganization
- **Retirement Hub ‚Üí Primary Tool** (replaced Tax-Loss Harvester)
- **Advisor Dashboard Hidden** from client view (access via direct URL only)
- Advisor separation discussion: future subdomain `advisor.mavenwealth.ai`

### Monte Carlo Improvements
- Added "üéØ At Retirement (Age X)" milestone card showing:
  - Portfolio balance at retirement age
  - Social Security income + start age
  - Target spending (annual + monthly)
  - Initial withdrawal rate (color-coded)
  - Link to Social Security Optimizer

### "How Does This Work?" (ToolExplainer)
Built reusable component with educational explanations for 13 tools:
- Modal shows: Summary, Methodology, Data Sources, Limitations
- Added to: Monte Carlo, Fragility Index, Social Security, Tax-Loss Harvesting, Oracle, Portfolio Lab, Safe Withdrawal, Stress Test, Market Outlook, Sensitivity, Asset Location, Income Planner, Retirement Optimizer

### Oracle Unification
- Fixed: MavenChat now dynamically checks if Claude is enabled
- Shows "Powered by Claude" (green) or "‚ö†Ô∏è Limited Mode" (amber)
- Verified: Claude IS enabled in production (`claudeEnabled: true`)

### Persistent Memory System
Created memory system for Oracle to learn from conversations:
- New API: `/api/oracle/memory`
- Extracts: preferences, goals, concerns, risk tolerance, family info
- Memories included in Claude's system prompt
- Prisma schema: `OracleMemory` model added

### "EZ Button" Pattern (OracleShowcase)
Built `OracleShowcase` component ‚Äî one-click AI explanations with:
- 4 tabs: Overview, Compare, Stress Test, Projections
- Animated charts and visualizations
- Claude-powered personalized analysis
- Gamified action items

Added to tools:
1. **Portfolio Lab** ‚Üí "Have Maven Oracle Explain These Changes"
2. **Monte Carlo** ‚Üí "Have Maven Oracle Explain My Retirement Outlook"
3. **Tax-Loss Harvesting** ‚Üí "Have Maven Oracle Walk Me Through This"
4. **Fragility Index** ‚Üí "Have Maven Oracle Explain What This Means"
5. **Social Security** ‚Üí "Have Maven Oracle Compare My Claiming Options"

### Sam's Question: Am I Learning?
Honest answer:
- ‚úÖ I read MEMORY.md each session (curated knowledge)
- ‚úÖ I update daily notes
- ‚úÖ Oracle now has persistent memory (within sessions)
- ‚ùå Not yet: Pattern recognition across sessions
- ‚ùå Not yet: Proactive suggestions without prompting
- üí° Idea: Create `PROACTIVE.md` to track patterns + improvement ideas

### Deployment
- 95 routes live at https://mavenwealth.ai
- New: `/api/oracle/memory` endpoint

---

## Data Provider Architecture (2:45 PM)

Sam's directive: **"Set everything up to be proactive. Always make sure there's an ability to have data built in now and for a live feed of data or if you are building a simulator that we could pay up for data at some point."**

### Built: Dual-Mode Data Architecture
Created `/lib/data-providers/` ‚Äî mock data now, live APIs later. One switch to swap.

**Structure:**
```
lib/data-providers/
‚îú‚îÄ‚îÄ types.ts           # All interfaces (Holding, FundData, TaxLot, etc.)
‚îú‚îÄ‚îÄ index.ts           # Factory functions, config detection
‚îú‚îÄ‚îÄ DATA-SOURCES.md    # Documentation + cost analysis
‚îî‚îÄ‚îÄ mock/
    ‚îú‚îÄ‚îÄ portfolio.ts   # Demo holdings (Sam's TAO/CIFR/IREN portfolio)
    ‚îú‚îÄ‚îÄ fund.ts        # Morningstar-style fund data
    ‚îî‚îÄ‚îÄ tax.ts         # Tax lots with wash sale tracking
```

**Configuration via env:**
```
DATA_PROVIDER_PORTFOLIO=mock  # ‚Üí Plaid ($500/mo)
DATA_PROVIDER_FUND=mock       # ‚Üí Morningstar ($25-50K/yr)
DATA_PROVIDER_TAX=mock        # ‚Üí Brokerage API
DATA_PROVIDER_MARKET=live     # Yahoo/CoinGecko already live
DATA_PROVIDER_ECONOMIC=live   # FRED already live
```

**React hooks created:**
- `useAccounts()`, `useHoldings()`, `useTotalValue()`
- `useFundData()`, `useFundSearch()`, `useFundComparison()`, `useFundOverlap()`
- `useTaxLots()`, `useHarvestingOpportunities()`, `useCapitalGainsSummary()`
- `useDataSources()` ‚Äî tells components what mode they're in

### New Page: Fund X-Ray (`/fund-xray`)
Showcases the data provider pattern:
- Search/analyze any fund (VTI, QQQ, AGTHX, etc.)
- Morningstar-style style box visualization
- Sector allocation chart
- Top 10 holdings
- Fund comparison with overlap analysis
- "What Morningstar integration would unlock" upsell

### API: `/api/data-sources`
Returns current data source configuration ‚Äî useful for debugging and transparency.

### Cost Analysis (in DATA-SOURCES.md)
| Service | Annual Cost | What You Get |
|---------|-------------|--------------|
| Current (free) | $0 | Yahoo, CoinGecko, FRED, FMP basic |
| + Plaid | ~$6K/yr | Real account aggregation |
| + Morningstar | ~$35K/yr | Fund X-ray, ratings, holdings |
| + Bloomberg | ~$24K/yr | Terminal (if institutional) |

**Recommended path:**
1. Now: Free tiers + mock data ‚úÖ
2. Phase 2: Add Plaid ($500/mo) for real holdings
3. Phase 3: Evaluate Morningstar vs alternatives

### Why This Matters
- Every page can show realistic demo data
- Flip one env var to go live
- No code changes when upgrading data sources
- Clear documentation of what each API unlocks
- Cost-aware architecture from day one

---

## Investment Intelligence Layer (3:00 PM)

Sam's insight: **"Why are we recommending certain allocation changes? Is it just historical data? What's driving it?"**

He's right ‚Äî most robo-advisors just run mean-variance optimization and call it a day. That's how you end up recommending international for a decade while it underperforms.

### Built: Thesis-Driven Allocation Framework

**New page: `/investment-thesis`**
- Shows our view on every asset class with full reasoning
- Not just "optimizer says 20%" but "here's WHY 20%, here's what could go wrong"

**For each asset class, we explain:**
1. **Structural Case**: Fundamental reason it exists in portfolios
2. **Valuation Assessment**: Cheap/fair/expensive with metrics (CAPE, P/E, etc.)
3. **Regime Context**: Current environment, catalysts, headwinds
4. **Expected Returns**: 10-year CMAs from Vanguard, BlackRock, JPM, AQR
5. **Honest Uncertainty**: What could go wrong, timing risk, historical base rates
6. **Our Recommendation**: Stance + target range + caveats

**Current Views Defined:**
- US Large Cap: Neutral (expensive but quality)
- International Developed: Overweight (50% discount, but value trap risk)
- Emerging Markets: Neutral (cheap but China overhang)
- US Bonds: Neutral (finally investable at 4.5%)
- Crypto: Overweight (high conviction, position size for volatility)

**Key Philosophy:**
- "International is cheap" has been true since 2015 ‚Äî we acknowledge this
- CMAs show range, not precision (US 10yr: 4-8% depending on source)
- Timing is impossible ‚Äî we say so explicitly
- Mean-variance is a tool, not the answer

### Created: Investment Research Doc
`docs/INVESTMENT-RESEARCH.md` ‚Äî Living document I'll update with ongoing research:
- Current market regime
- Regional research (US, Int'l, EM, Bonds)
- Thematic research (AI infrastructure, dollar, crypto)
- Capital market assumptions from major asset managers
- Historical lessons (int'l value trap, bond bear market)

### Helper Functions
`lib/investment-thesis/index.ts`:
- `explainAllocationChange()` ‚Äî Thesis-backed explanation for changes
- `getPortfolioThesisSummary()` ‚Äî Check if allocation is in recommended ranges
- `generateOptimizationExplanation()` ‚Äî Full explanation for Portfolio Lab

**98 routes live** including `/investment-thesis`

---

## Running Deployment
All caught up as of 3:05 PM.

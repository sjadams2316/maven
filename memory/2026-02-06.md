# 2026-02-06 — Maven Build Day (Major Progress)

## Summary
Massive day building Maven. Went from basic prototype to production-ready wealth platform with real-time data.

## Major Features Built

### 1. Progressive Signup Flow
- Users fill out onboarding without signing up first
- After welcome step → "Save Your Progress" modal
- Clerk sends 6-digit verification code
- On verify → signed in, data saves to DB
- Skip option available (data stays in localStorage)

### 2. Ask Maven (Ticker Lookup)
- "Can't find it? Ask Maven" option in holdings search
- Uses Claude + web search to identify obscure tickers
- Returns ticker + name + current price

### 3. Brave Search Integration
- Added `BRAVE_SEARCH_API_KEY` to Vercel
- Oracle and Ask Maven can now search the web in real-time
- Key: `BSA7XxgjGxdFlFJJr5vqJVJ8UkTkRYF`

### 4. Cash Optimization
- Added CASH-USD, money market funds (SPAXX, VMFXX, SWVXX, etc.)
- Knowledge base section on cash optimization
- Proactive alerts when cash > 15% of portfolio
- Calculates opportunity cost of idle cash

### 5. Real-Time Morningstar Data
- `/api/fund-profile` — fetches from Yahoo Finance:
  - Morningstar category (e.g., "World Large-Stock Growth")
  - Star rating (1-5)
  - Risk rating
  - Asset allocation (stocks/bonds/cash)
  - Geographic breakdown
  - Top holdings, performance, expense ratio
- 4-hour cache for efficiency
- Dashboard auto-fetches profiles for all holdings

### 6. Full Yahoo Finance Search
- `/api/search` — real-time search across all Yahoo Finance
- Search by ticker OR name
- Shows type badges: Stock, ETF, Mutual Fund, Crypto
- Replaces hardcoded 100-ticker list with unlimited access

### 7. Fixed Asset Classifications
- CASH-USD → Cash (was US Equity)
- ANEFX (New Economy) → Int'l Equity (Diversified Emerging Markets)
- ANWFX (New Perspective) → Int'l Equity (World Large Stock)
- TAOX → Crypto (fixed issuer name to Valour, not 21Shares)
- Added 5th category: Cash (gray bar in allocation chart)

## API Endpoints Added
- `/api/search` — Yahoo Finance ticker search
- `/api/fund-profile` — Morningstar fund data

## Key Decisions
- Use Yahoo Finance for all market data (free, comprehensive)
- Morningstar category determines asset classification
- Geographic breakdown (<60% US = International)
- 4-hour cache on fund profiles (balance freshness vs API calls)

## Sam's Feedback (Important)
- "Don't you think we should do it by true Morningstar classification?"
- Wants EVERYTHING available — all Yahoo Finance data, live updates
- Quality and accuracy matter more than speed

## Production URLs
- https://mavenwealth.ai (live)
- https://mavenwealth.ai/oracle
- https://mavenwealth.ai/onboarding

## Technical Notes
- CTA copy changed: "Let's see what we're working with"
- "Setup" → "Sign Up" in header
- Progressive signup uses Clerk's `useSignUp` hook
- Fund profiles use `useFundProfiles` hook with localStorage cache

---

## Evening Session (8-10 PM)

### 8. Oracle Can Modify Holdings via Chat
- New tool: `update_holdings` — add, update, or remove holdings
- Example: "I also have 23k of TAOX" → Maven asks which account → saves to DB
- Smart follow-ups when info is missing (account type, custodian)
- `/api/user/holdings` — full CRUD API for holdings

### 9. Header/UX Fixes
- Created shared `Header` component across all pages
- "Settings" shows when signed in (was showing "Sign In")
- Maven logo always goes to `/` (homepage)
- Financial highlights show in header when user has data

### 10. Smart Homepage Redirect
- Middleware checks `maven_onboarded` cookie
- Signed in + onboarded → instantly redirect to dashboard
- Never see marketing page once you're set up
- Cookie set on onboarding complete (1 year expiry)

### 11. Data Persistence Fixes
- Added `profileData` JSON field to User model
- Full profile now saves to database (not just localStorage)
- Holdings save correctly (fixed broken upsert logic)
- Profile loads from DB on sign-in, syncs to localStorage

### 12. Progressive Signup Enhanced
- Password field added (8+ char requirement)
- Confirm password field
- Google OAuth option (one-click sign-in)
- Show/hide password toggle
- Mode toggle: "Already have an account?" ↔ "Need an account?"
- Proper `autocomplete` attributes for password managers
- SSO callback page for Google OAuth

### 13. Competitive Analysis: Troutwood
- Sam's friend knows the founder
- Research: Troutwood is "Mint + financial literacy content"
- B2B2C model (sells to employers)
- Our assessment: They teach about money, Maven helps WITH money
- Different leagues — we're a generation ahead on AI
- But they have years of enterprise relationships + revenue

### 14. Maven Basics Tier Added
- "Build for Olympic swimmers, section off a shallow end"
- Same Oracle, simplified for beginners
- Guided onboarding, concept explanations
- Target: B2B employee wellness market
- Ladder: Basics (free) → Maven ($12) → Premium ($25) → Pro ($300)

### 15. Gamification Design (Elon-Style)
Added full gamification section to MASTER-PLAN.md:
- **Wealth Velocity™** — Single score for financial momentum
- **Tax Alpha Counter™** — Running total of money saved
- **FI Countdown** — Days until financial independence
- **Mission Control Dashboard** — SpaceX-style wealth tracking
- **Achievement badges** — Real accomplishments (First 100K, Maxed Out, Tax Hunter)
- **Streak system** — Savings, growth, optimization streaks
- **Launch Moments** — Epic celebrations for milestones
- **Easter eggs** — Konami code, birthday surprises, random confetti
- **Shareable cards** — Brag without revealing amounts

Philosophy: "Make the mundane feel epic. Saving for retirement should feel like launching a rocket."

## Files Created/Modified
- `src/app/components/Header.tsx` — Shared header
- `src/app/api/user/holdings/route.ts` — Holdings CRUD API
- `src/app/sso-callback/page.tsx` — Google OAuth callback
- `src/middleware.ts` — Smart homepage redirect
- `prisma/schema.prisma` — Added `profileData` JSON field
- `MASTER-PLAN.md` — Added Maven Basics + Gamification sections

## Key Quotes from Sam
- "If we build for Olympic swimmers we can also have a basic version that teaches people to swim"
- "If Elon Musk were to gamify it how would he think about it"

---

## Late Night Session (8:45-9:00 PM) — Tax Alpha Counter

### 16. Tax Alpha Counter™ — Full Implementation

Built the entire Tax Alpha tracking system with Sam's iteration loop philosophy:

**Data Model (Prisma):**
- `TaxAlphaEvent` — Every optimization identified or executed
- `TaxAlphaSummary` — Cached totals for fast display
- Tracks: type, status, ticker, amount, tax saved, calculation breakdown

**Tax Calculator (`/lib/tax-calculator.ts`):**
- Real 2024 federal brackets by filing status
- LTCG rates (0%/15%/20%)
- NIIT (3.8% for high earners over threshold)
- All 50 states + DC tax rates
- Full calculation transparency

**Tax-Loss Scanner (`/lib/tax-loss-scanner.ts`):**
- Only scans TAXABLE accounts (skips 401k, IRA, Roth, HSA, 529)
- Requires cost basis (flags positions missing it)
- Wash sale detection across ALL accounts (including retirement!)
- Substantially identical security mapping (VOO/IVV/SPY = same)
- Substitute suggestions (sell VTI → buy VOO to maintain exposure)
- Holding period tracking (short-term vs long-term)

**API Endpoints:**
- `/api/tax-alpha` — GET/POST/PUT for tax alpha events
- `/api/tax-alpha/scan` — GET (preview) / POST (save) scanner

**UI Component (`TaxAlphaCounter.tsx`):**
- Animated counter (framer-motion)
- Realized vs Potential breakdown
- "Scan Portfolio" button
- Auto-scan on dashboard load
- Expandable history with calculation details
- Action buttons (Mark Executed / Dismiss)

**Oracle Integration:**
- `log_tax_alpha` tool — Create events through chat
- `scan_tax_losses` tool — Run scanner through chat

### Key Architecture Decisions

**What we handle:**
- ✅ Taxable vs tax-advantaged account filtering
- ✅ Cost basis requirement
- ✅ Wash sale risk detection (same ticker in any account)
- ✅ Substantially identical securities (index fund families)
- ✅ Holding period (short vs long term)
- ✅ Substitute security suggestions

**What still needs Plaid/Alpaca:**
- ❌ Actual purchase dates (transaction history)
- ❌ Per-lot tracking (FIFO/specific ID)
- ❌ 30-day wash sale window enforcement (needs transaction log)

### Sam's Iteration Loop

Added to SOUL.md as a core operating principle:

```
1. Verify — Does it actually work?
2. Critique — What would Sam push back on?
3. Anticipate — What's the 10% improvement?
4. Iterate — Make it, then check again.
```

Applied to Tax Alpha: v1 → v1.1 → v1.2 → v1.3 → v1.4 = proper production feature

---

## Late Night Session Part 2 (9:00-9:15 PM) — Transaction Infrastructure

Sam pushed back on the scanner: "What about wash sale window tracking? Per-lot tracking? You need purchase dates."

Answer: We need transaction history. Built the full infrastructure now so it's ready for Plaid/Alpaca.

### 17. Wash Sale Tracker (`/lib/wash-sale-tracker.ts`)

Complete IRS-compliant wash sale detection:

- **61-day window** — 30 days before AND after a sale
- **Cross-account detection** — Catches buys in retirement accounts
- **Substantially identical securities** — VOO/IVV/SPY are the same
- **Disallowed loss calculation** — Shows exactly how much gets disallowed
- **Basis adjustment** — Disallowed loss adds to replacement share basis
- **Safe to sell date** — Tells user when wash sale window expires
- **Reverse check** — Warns if buying would trigger wash sale on recent sales

### 18. Lot Manager (`/lib/lot-manager.ts`)

Per-lot cost basis tracking with multiple methods:

- **FIFO** — First In, First Out (default)
- **LIFO** — Last In, First Out  
- **HIFO** — Highest In, First Out (tax optimal for gains)
- **Specific Identification** — User chooses which lots

Features:
- Holding period calculation (short vs long term)
- Lot-level gain/loss (find losses in profitable positions!)
- Optimal lot selection for harvesting
- Integration with wash sale checker

### 19. Transaction API (`/api/transactions`)

Full transaction recording with automatic lot management:

**POST (buy):**
- Records transaction
- Auto-creates TaxLot
- Warns if purchase triggers wash sale on recent sales

**POST (sell):**
- Records transaction
- Disposes from lots (FIFO/LIFO/HIFO)
- Creates Disposition records
- Checks wash sale violations
- Returns full tax breakdown

### 20. Transaction Preview (`/api/transactions/preview`)

Preview before selling — the killer feature:

- Shows which lots will be sold
- Compares FIFO vs LIFO vs HIFO
- Recommends optimal method
- Calculates tax impact
- Warns about wash sales
- Shows "safe to sell" date

### 21. Oracle Tools Added

- `preview_sale` — Preview tax impact of selling shares

### What This Enables (Once Plaid/Alpaca Connected)

| Feature | Status |
|---------|--------|
| Per-lot cost basis | ✅ Ready (needs transaction data) |
| FIFO/LIFO/HIFO selection | ✅ Ready |
| Wash sale detection | ✅ Ready (needs transaction data) |
| 30-day window enforcement | ✅ Ready |
| Cross-account wash sales | ✅ Ready |
| Optimal lot selection | ✅ Ready |
| Sale tax preview | ✅ Ready |

### Sam's Insight

"The purchase dates issue will be solved if we have full account integration with Plaid or have them trading through our interface (Alpaca)"

Exactly right. The infrastructure is built. Data flows in from:
1. **Plaid** → Investment transactions → Auto-create lots
2. **Alpaca** → Real-time trades → Auto-create lots
3. **Manual** → User enters transactions → Creates lots

### Files Created

- `/lib/wash-sale-tracker.ts` — Wash sale detection + enforcement
- `/lib/lot-manager.ts` — Per-lot cost basis management
- `/api/transactions/route.ts` — Record buy/sell transactions
- `/api/transactions/preview/route.ts` — Preview sale tax impact

---

*Infrastructure for institutional-grade tax tracking is LIVE. Just needs data from Plaid/Alpaca.*

---

## Overnight Research Mission (9:15 PM onwards)

Sam: "Think big and pick 20 topics to research, go deep, iterate the app based on research."

### Research Agents Spawned

**Tax Optimization (5):**
1. QSBS (Qualified Small Business Stock)
2. NUA (Net Unrealized Appreciation)
3. Charitable giving optimization
4. Opportunity Zones
5. Crypto tax strategies

**Retirement Planning (4):**
6. Social Security optimization
7. Medicare IRMAA planning
8. RMD strategies
9. Sequence of returns risk

**Investment Intelligence (4):**
10. Direct indexing
11. Factor investing
12. Concentrated position hedging (options, collars)
13. Alternative investments for retail

**Behavioral & UX (2):**
14. What makes people follow financial advice
15. Gamification case studies (Duolingo, Robinhood, etc.)

**Competitive & Market (3):**
16. RIA technology landscape
17. Embedded finance trends
18. AI in wealth management

**Product Ideas (2):**
19. Family office services (what to democratize)
20. Financial planning UX best practices

### Output Locations
All findings saved to `memory/research/` in organized subdirectories:
- `tax-strategies/`
- `retirement/`
- `investment-strategies/`
- `behavioral-finance/`
- `product-design/`
- `competitive-landscape/`
- `market-trends/`
- `product-ideas/`

### Objective
Not just research — identify opportunities to improve Maven's:
1. Knowledge base (what Maven knows)
2. Features (what Maven can do)
3. UX (how Maven presents information)
4. Proactive insights (what Maven surfaces automatically)

---

*20 agents working overnight. Report in the morning.*
